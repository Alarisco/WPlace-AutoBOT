# ü§ù Gu√≠a de Contribuci√≥n

¬°Gracias por tu inter√©s en contribuir a WPlace AutoBOT! Esta gu√≠a te ayudar√° a entender c√≥mo funciona el proyecto y c√≥mo puedes colaborar.

## üìã Reglas B√°sicas

- ‚úÖ **Conventional Commits:** Usa el formato est√°ndar en tus PRs
- ‚úÖ **Issues primero:** Para cambios grandes, abre un Issue antes del PR
- ‚úÖ **CI/CD:** El sistema valida autom√°ticamente JS, Markdown y YAML
-### Ideas para Contribuir

#### üî• PRIORIDAD ALTA: Completar Migraci√≥n Modular

El proyecto necesita completar la migraci√≥n del c√≥digo monol√≠tico a la arquitectura modular:

**Farm Module (`src/farm/`):**
- [ ] Migrar configuraci√≥n y estado desde `Auto-Farm.original.js`
- [ ] Extraer UI compleja (paneles, controles, configuraci√≥n)
- [ ] Separar l√≥gica de pintado y cooldowns
- [ ] Implementar calibraci√≥n autom√°tica
- [ ] Sistema de retry y manejo de errores

**Image Module (`src/image/`):**
- [ ] Migrar procesamiento de im√°genes desde `Auto-Image.original.js`
- [ ] Sistema de progreso y guardado/carga
- [ ] UI de configuraci√≥n (redimensionado, paleta, posici√≥n)
- [ ] Optimizaci√≥n de batches por tiles
- [ ] Validaci√≥n de colores

**Core Modules (`src/core/`):**
- [ ] Expandir `wplace-api.js` con todas las llamadas API
- [ ] Mejorar `turnstile.js` con gesti√≥n completa
- [ ] Sistema robusto de configuraci√≥n en `storage.js`
- [ ] Logging completo en `logger.js`

**C√≥mo Contribuir a la Migraci√≥n:**

1. **Elige un m√≥dulo espec√≠fico** (ej: `src/farm/coords.js`)
2. **Estudia el c√≥digo original** en `Auto-Farm.original.js`
3. **Extrae la funcionalidad** relacionada
4. **Mant√©n la API compatible** 
5. **A√±ade tests si es posible**
6. **Documenta los cambios**

**Cuando la migraci√≥n est√© completa:**
- Cambiar `useOriginals = false` en `build.mjs`
- Los archivos se generar√°n desde `src/`
- Eliminar archivos `.original.js`

#### Nuevas Funcionalidades**Bookmarklets:** Deben apuntar a `raw.githubusercontent.com/.../main/Auto-*.js`

---

## üèóÔ∏è Estructura del Proyecto

El proyecto est√° modularizado para facilitar el mantenimiento y desarrollo:

```
WPlace-AutoBOT/
‚îú‚îÄ‚îÄ src/                    # C√≥digo fuente modular
‚îÇ   ‚îú‚îÄ‚îÄ core/              # M√≥dulos base reutilizables
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dom.js         # Utilidades DOM y Shadow DOM
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ http.js        # fetchWithTimeout y utilidades HTTP
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loader.js      # loadAndEvalUrlWithFallback
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.js      # Sistema de logging
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ storage.js     # LocalStorage wrapper
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ timing.js      # sleep() y retry()
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ turnstile.js   # Carga y ejecuci√≥n de Turnstile
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ wplace-api.js  # API unificada de WPlace
‚îÇ   ‚îú‚îÄ‚îÄ ui/                # Componentes de interfaz
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ drag.js        # makeDraggable
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ overlay.js     # createOverlay con Shadow DOM
‚îÇ   ‚îú‚îÄ‚îÄ farm/              # L√≥gica del Auto-Farm
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ calibrate.js   # Calibraci√≥n por fetch sniffing
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ coords.js      # Coordenadas aleatorias y colores
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js       # runFarm principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loop.js        # Loop de pintado y retry
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui.js          # UI espec√≠fica del farm
‚îÇ   ‚îú‚îÄ‚îÄ image/             # L√≥gica del Auto-Image
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ batcher.js     # Agrupaci√≥n por tiles
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ image-processor.js # Procesamiento de im√°genes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js       # runImage principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loop.js        # Loop de pintado por lotes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ palette.js     # Coincidencia de colores
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ progress.js    # Persistencia de progreso
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui.js          # UI espec√≠fica de imagen
‚îÇ   ‚îî‚îÄ‚îÄ entries/           # Puntos de entrada (bookmarklets)
‚îÇ       ‚îú‚îÄ‚îÄ farm.js        # Entry point para Auto-Farm.js
‚îÇ       ‚îú‚îÄ‚îÄ image.js       # Entry point para Auto-Image.js
‚îÇ       ‚îî‚îÄ‚îÄ launcher.js    # Entry point para Auto-Launcher.js
‚îú‚îÄ‚îÄ Auto-Farm.js           # üî¥ GENERADO - No editar
‚îú‚îÄ‚îÄ Auto-Image.js          # üî¥ GENERADO - No editar
‚îú‚îÄ‚îÄ Auto-Launcher.js       # üî¥ GENERADO - No editar
‚îú‚îÄ‚îÄ build.mjs              # Script de build con esbuild
‚îú‚îÄ‚îÄ package.json           # Dependencias y scripts
‚îú‚îÄ‚îÄ eslint.config.js       # Configuraci√≥n de ESLint v9
‚îú‚îÄ‚îÄ .prettierrc            # Configuraci√≥n de Prettier
‚îî‚îÄ‚îÄ docs/
    ‚îú‚îÄ‚îÄ CONTRIBUTING.md    # Esta gu√≠a
    ‚îú‚îÄ‚îÄ SECURITY.md        # Pol√≠tica de seguridad
    ‚îî‚îÄ‚îÄ SUPPORT.md         # Gu√≠a de soporte
```

## üîß Scripts Disponibles

### Instalaci√≥n de Dependencias

```bash
# Instalar todas las dependencias
npm install
```

### Scripts de Build

```bash
# Build de producci√≥n (minificado)
npm run build

# Build de desarrollo (con sourcemaps)
npm run build:dev

# Modo watch (reconstruye autom√°ticamente)
npm run watch

# Linter
npm run lint
```

### Detalles de los Scripts

#### `npm run build`
- ‚úÖ **Minificaci√≥n:** C√≥digo optimizado para producci√≥n
- ‚úÖ **Bundle:** Todo el c√≥digo en archivos √∫nicos IIFE
- ‚úÖ **Target:** ES2019 para m√°xima compatibilidad
- ‚úÖ **Banner:** Incluye timestamp de compilaci√≥n

#### `npm run build:dev`
- ‚úÖ **Sin minificar:** C√≥digo legible para debug
- ‚úÖ **Sourcemaps:** Mapeo a c√≥digo fuente original
- ‚úÖ **Debug mode:** `NODE_ENV=development`

#### `npm run watch`
- ‚úÖ **Auto-rebuild:** Detecta cambios en `src/`
- ‚úÖ **Notificaciones:** Informa √©xito/error de rebuild
- ‚úÖ **Desarrollo continuo:** Ideal para desarrollo activo

#### `npm run lint`
- ‚úÖ **ESLint v9:** Configuraci√≥n moderna
- ‚úÖ **Errores y warnings:** Detecta problemas de c√≥digo
- ‚úÖ **Est√°ndares:** Aplica buenas pr√°cticas

## ‚öôÔ∏è Sistema de Build

### Estado Actual: Migraci√≥n en Progreso

> ‚ö†Ô∏è **Nota Importante**: Actualmente el proyecto est√° en **migraci√≥n gradual** hacia la arquitectura modular. 
> Los archivos `Auto-*.js` utilizan temporalmente el c√≥digo original mientras completamos la refactorizaci√≥n.

### Proceso con esbuild

El sistema est√° configurado para usar **esbuild** para generar los 3 archivos finales en la ra√≠z:

```javascript
// build.mjs - Estado actual
const useOriginals = true; // üîÑ Cambiar√° a false cuando la migraci√≥n est√© completa

if (useOriginals) {
  // Copia los archivos originales (comportamiento actual)
  copyFileSync("Auto-Farm.original.js", "Auto-Farm.js");
  // ...
} else {
  // Genera desde m√≥dulos en src/ (objetivo final)
  // ...
}
```

### Configuraci√≥n Final (en desarrollo)

```javascript
// build.mjs
const jobs = [
  { in: "src/entries/farm.js",     out: "Auto-Farm.js" },
  { in: "src/entries/image.js",    out: "Auto-Image.js" },
  { in: "src/entries/launcher.js", out: "Auto-Launcher.js" }
]
```

### Configuraci√≥n

```javascript
const common = {
  bundle: true,
  format: "iife",           // Ideal para bookmarklets
  target: ["es2019"],       // Compatibilidad amplia
  legalComments: "none",    // Sin comentarios de licencia
  banner: {
    js: "/* WPlace AutoBOT ‚Äî uso bajo tu responsabilidad. Compilado [timestamp] */"
  }
}
```

### ¬øPor qu√© IIFE?

- **Bookmarklets:** Formato perfecto para `javascript:` URLs
- **Encapsulaci√≥n:** No contamina el scope global
- **Compatibilidad:** Funciona en todos los navegadores

## üîÑ Flujo de Desarrollo

### 1. Setup Inicial

```bash
# Clonar el repositorio
git clone https://github.com/Alarisco/WPlace-AutoBOT.git
cd WPlace-AutoBOT

# Instalar dependencias
npm install

# Verificar que todo funciona
npm run build
```

### 2. Desarrollo

```bash
# Modo watch para desarrollo
npm run watch

# En otra terminal, servir archivos (opcional)
python3 -m http.server 8000
```

### 3. Editar C√≥digo

- ‚úÖ **Solo edita archivos en `src/`**
- ‚ùå **NUNCA edites los archivos `Auto-*.js`** (se sobrescriben)
- ‚úÖ **Usa el linter:** `npm run lint`
- ‚úÖ **Prueba frecuentemente:** Los archivos se regeneran autom√°ticamente

### 4. Testing

```bash
# Build final antes de commit
npm run build

# Verificar que no hay errores de lint
npm run lint

# Probar los bookmarklets generados
```

### 5. Commit y PR

```bash
# Conventional commits
git add .
git commit -m "feat(core): nueva funcionalidad X"
git push origin feature/nueva-funcionalidad

# Abrir PR en GitHub
```

## üìù Conventional Commits

Usa este formato para tus commits:

```
<type>(<scope>): <description>

[optional body]

[optional footer]
```

### Tipos V√°lidos

- `feat`: Nueva funcionalidad
- `fix`: Correcci√≥n de bug
- `docs`: Solo documentaci√≥n
- `style`: Formato, espacios, etc
- `refactor`: Reestructuraci√≥n sin cambios funcionales
- `test`: A√±adir o corregir tests
- `chore`: Mantenimiento, deps, build

### Scopes Recomendados

- `core`: M√≥dulos base (`src/core/`)
- `ui`: Componentes de interfaz (`src/ui/`)
- `farm`: Auto-Farm (`src/farm/`)
- `image`: Auto-Image (`src/image/`)
- `build`: Sistema de build
- `docs`: Documentaci√≥n

### Ejemplos

```bash
feat(core): a√±adir m√≥dulo de retry con backoff exponencial
fix(farm): corregir calibraci√≥n en tiles negativos
docs(readme): actualizar gu√≠a de instalaci√≥n
refactor(ui): migrar overlay a shadow DOM
chore(build): actualizar esbuild a v0.21.5
```

## üß™ Testing y Calidad

### Linting

El proyecto usa ESLint v9 con configuraci√≥n moderna:

```javascript
// eslint.config.js
export default [
  js.configs.recommended,
  {
    languageOptions: {
      ecmaVersion: 2021,
      sourceType: 'module',
      globals: { /* browser globals */ }
    },
    rules: {
      'no-unused-vars': ['warn', { args: 'none' }],
      'no-implicit-globals': 'error',
      'no-alert': 'off'  // Los bookmarklets usan alert
    }
  }
];
```

### Prettier

Formateo autom√°tico:

```json
{
  "singleQuote": true,
  "semi": true,
  "printWidth": 100
}
```

## üöÄ Arquitectura

### M√≥dulos Core

#### `src/core/wplace-api.js`
API unificada para WPlace:
- `getSession()` - Obtener datos del usuario
- `checkHealth()` - Estado del servidor
- `postPixelBatch()` - Env√≠o de p√≠xeles por lotes

#### `src/core/turnstile.js`
Gesti√≥n de Cloudflare Turnstile:
- `loadTurnstile()` - Carga el script
- `executeTurnstile()` - Obtiene tokens

#### `src/core/http.js`
Utilidades HTTP:
- `fetchWithTimeout()` - Fetch con timeout

### Entry Points

Cada entry point (`src/entries/*.js`) envuelve la l√≥gica principal:

```javascript
// src/entries/farm.js
import { runFarm } from "../farm/index.js";

(() => {
  "use strict";
  if (window.__wplaceBot?.running) {
    alert("WPlace BOT ya est√° corriendo.");
    return;
  }
  window.__wplaceBot = { running: true };
  runFarm().catch(/* error handling */);
})();
```

### UI Components

#### Shadow DOM
Evita conflictos CSS con la p√°gina:

```javascript
// src/ui/overlay.js
import { mountShadow } from "../core/dom.js";

export function createOverlay({ title = "WPlace BOT" } = {}) {
  const { host, root } = mountShadow();
  // UI components...
}
```

## üîç Debugging

### Console Commands

```javascript
// Debug de coordenadas
debugCoords()

// Debug de cargas
debugCharges()

// Configurar p√≠xeles por lote
setPixelsPerBatch(25)

// Ver estado actual
console.log(window.__wplaceBot)
```

### Build Debug

```bash
# Build en modo desarrollo
npm run build:dev

# Los sourcemaps permiten debugging en devtools
```

## üì¶ Releases

### Proceso de Release

1. **Develop en rama feature**
2. **PR a `main`**
3. **CI/CD valida autom√°ticamente**
4. **Merge crea nueva release**
5. **Bookmarklets** apuntan autom√°ticamente a la nueva versi√≥n

### Versioning

- Usa **Semantic Versioning** (`MAJOR.MINOR.PATCH`)
- Tags en formato `vX.Y.Z`
- Los bookmarklets siempre cargan desde `main`

## üí° Ideas para Contribuir

### Nuevas Funcionalidades

- üé® **Filtros de imagen:** Blur, sharpen, contrast
- üéØ **Modos de pintado:** Espiral, por l√≠neas, aleatorio
- üìä **Analytics:** Estad√≠sticas de pintado
- üîÑ **Sync:** Sincronizaci√≥n entre dispositivos
- üéÆ **Templates:** Plantillas predefinidas

### Mejoras T√©cnicas

- ‚ö° **Performance:** Optimizaci√≥n de algoritmos
- üõ°Ô∏è **Security:** Validaci√≥n adicional
- üåê **I18n:** Internacionalizaci√≥n
- üì± **Mobile:** Mejoras para m√≥viles
- üß™ **Tests:** Testing automatizado

### Documentaci√≥n

- üìñ **Wiki:** Gu√≠as avanzadas
- üé• **Videos:** Tutoriales
- üåç **Traducciones:** Otros idiomas
- üìä **Examples:** Casos de uso

## üÜò Ayuda

### Problemas Comunes

**"Module not found"**
```bash
npm install  # Reinstalar dependencias
```

**"Build failed"**
```bash
npm run lint  # Verificar errores de sintaxis
```

**"Watch no funciona"**
```bash
# Verificar que los archivos est√°n en src/
ls -la src/
```

### Contacto

- üêõ **Bugs:** [GitHub Issues](https://github.com/Alarisco/WPlace-AutoBOT/issues)
- üí¨ **Discusiones:** [GitHub Discussions](https://github.com/Alarisco/WPlace-AutoBOT/discussions)
- üìß **Email:** A trav√©s de GitHub

---

<p align="center">
  <strong>¬°Gracias por contribuir a WPlace AutoBOT! üé®</strong><br>
  <em>Juntos hacemos que la comunidad de WPlace sea m√°s creativa</em>
</p>
